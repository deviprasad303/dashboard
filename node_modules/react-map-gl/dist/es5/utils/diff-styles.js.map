{"version":3,"sources":["../../../src/utils/diff-styles.js"],"names":["diffSources","prevStyle","nextStyle","prevSources","get","nextSources","enter","update","exit","prevIds","keySeq","toArray","nextIds","id","nextSource","equals","push","source","prevSource","diffLayers","prevLayers","nextLayers","updates","exiting","prevMap","nextMap","forEach","layer","index","layerImBehind","before","reverse","diffStyle","sourcesDiff","layersDiff"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* eslint-disable max-statements */\nexport function diffSources(prevStyle, nextStyle) {\n  const prevSources = prevStyle.get('sources');\n  const nextSources = nextStyle.get('sources');\n  const enter = [];\n  const update = [];\n  const exit = [];\n  const prevIds = prevSources.keySeq().toArray();\n  const nextIds = nextSources.keySeq().toArray();\n  for (const id of prevIds) {\n    const nextSource = nextSources.get(id);\n    if (nextSource) {\n      if (!nextSource.equals(prevSources.get(id))) {\n        update.push({id, source: nextSources.get(id)});\n      }\n    } else {\n      exit.push({id, source: prevSources.get(id)});\n    }\n  }\n  for (const id of nextIds) {\n    const prevSource = prevSources.get(id);\n    if (!prevSource) {\n      enter.push({id, source: nextSources.get(id)});\n    }\n  }\n  return {enter, update, exit};\n}\n/* eslint-enable max-statements */\n\nexport function diffLayers(prevStyle, nextStyle) {\n  const prevLayers = prevStyle.get('layers');\n  const nextLayers = nextStyle.get('layers');\n  const updates = [];\n  const exiting = [];\n  const prevMap = {};\n  const nextMap = {};\n  nextLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = nextLayers.get(index + 1);\n    nextMap[id] = {\n      layer,\n      id,\n      // The `id` of the layer before this one.\n      before: layerImBehind ? layerImBehind.get('id') : null,\n      enter: true\n    };\n  });\n  prevLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = prevLayers.get(index + 1);\n    prevMap[id] = {\n      layer,\n      id,\n      before: layerImBehind ? layerImBehind.get('id') : null\n    };\n    if (nextMap[id]) {\n      // Not a new layer.\n      nextMap[id].enter = false;\n    } else {\n      // This layer is being removed.\n      exiting.push(prevMap[id]);\n    }\n  });\n  for (const layer of nextLayers.reverse()) {\n    const id = layer.get('id');\n    if (\n      !prevMap[id] ||\n      !prevMap[id].layer.equals(nextMap[id].layer) ||\n      prevMap[id].before !== nextMap[id].before\n    ) {\n      // This layer is being changed.\n      updates.push(nextMap[id]);\n    }\n  }\n  return {updates, exiting};\n}\n\nexport default function diffStyle(prevStyle, nextStyle) {\n  return {\n    sourcesDiff: diffSources(prevStyle, nextStyle),\n    layersDiff: diffLayers(prevStyle, nextStyle)\n  };\n}\n"],"file":"diff-styles.js"}