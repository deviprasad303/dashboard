{"version":3,"sources":["../../../src/utils/diff-styles.js"],"names":["diffSources","prevStyle","nextStyle","prevSources","get","nextSources","enter","update","exit","prevIds","keySeq","toArray","nextIds","id","nextSource","equals","push","source","prevSource","diffLayers","prevLayers","nextLayers","updates","exiting","prevMap","nextMap","forEach","layer","index","layerImBehind","before","reverse","diffStyle","sourcesDiff","layersDiff"],"mappings":"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","sourcesContent":["// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* eslint-disable max-statements */\nexport function diffSources(prevStyle, nextStyle) {\n  const prevSources = prevStyle.get('sources');\n  const nextSources = nextStyle.get('sources');\n  const enter = [];\n  const update = [];\n  const exit = [];\n  const prevIds = prevSources.keySeq().toArray();\n  const nextIds = nextSources.keySeq().toArray();\n  for (const id of prevIds) {\n    const nextSource = nextSources.get(id);\n    if (nextSource) {\n      if (!nextSource.equals(prevSources.get(id))) {\n        update.push({id, source: nextSources.get(id)});\n      }\n    } else {\n      exit.push({id, source: prevSources.get(id)});\n    }\n  }\n  for (const id of nextIds) {\n    const prevSource = prevSources.get(id);\n    if (!prevSource) {\n      enter.push({id, source: nextSources.get(id)});\n    }\n  }\n  return {enter, update, exit};\n}\n/* eslint-enable max-statements */\n\nexport function diffLayers(prevStyle, nextStyle) {\n  const prevLayers = prevStyle.get('layers');\n  const nextLayers = nextStyle.get('layers');\n  const updates = [];\n  const exiting = [];\n  const prevMap = {};\n  const nextMap = {};\n  nextLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = nextLayers.get(index + 1);\n    nextMap[id] = {\n      layer,\n      id,\n      // The `id` of the layer before this one.\n      before: layerImBehind ? layerImBehind.get('id') : null,\n      enter: true\n    };\n  });\n  prevLayers.forEach((layer, index) => {\n    const id = layer.get('id');\n    const layerImBehind = prevLayers.get(index + 1);\n    prevMap[id] = {\n      layer,\n      id,\n      before: layerImBehind ? layerImBehind.get('id') : null\n    };\n    if (nextMap[id]) {\n      // Not a new layer.\n      nextMap[id].enter = false;\n    } else {\n      // This layer is being removed.\n      exiting.push(prevMap[id]);\n    }\n  });\n  for (const layer of nextLayers.reverse()) {\n    const id = layer.get('id');\n    if (\n      !prevMap[id] ||\n      !prevMap[id].layer.equals(nextMap[id].layer) ||\n      prevMap[id].before !== nextMap[id].before\n    ) {\n      // This layer is being changed.\n      updates.push(nextMap[id]);\n    }\n  }\n  return {updates, exiting};\n}\n\nexport default function diffStyle(prevStyle, nextStyle) {\n  return {\n    sourcesDiff: diffSources(prevStyle, nextStyle),\n    layersDiff: diffLayers(prevStyle, nextStyle)\n  };\n}\n"],"file":"diff-styles.js"}